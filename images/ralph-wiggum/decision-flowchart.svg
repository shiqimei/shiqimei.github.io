<svg viewBox="0 0 700 520" xmlns="http://www.w3.org/2000/svg" style="background:#000;">
  <!-- Title -->
  <text x="350" y="25" font-family="SF Mono, monospace" font-size="14" fill="#fff" text-anchor="middle" font-weight="bold">stop-hook.sh Decision Logic</text>

  <!-- START -->
  <ellipse cx="350" cy="65" rx="40" ry="18" fill="#111" stroke="#fff" stroke-width="2"/>
  <text x="350" y="70" font-family="SF Mono, monospace" font-size="10" fill="#fff" text-anchor="middle">START</text>

  <!-- Arrow down -->
  <line x1="350" y1="83" x2="350" y2="110" stroke="#555" stroke-width="2"/>
  <polygon points="350,120 343,107 357,107" fill="#555"/>

  <!-- Diamond 1: State file exists? -->
  <polygon points="350,125 460,170 350,215 240,170" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="350" y="167" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">State file</text>
  <text x="350" y="181" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">exists?</text>

  <!-- No branch left -->
  <line x1="240" y1="170" x2="150" y2="170" stroke="#555" stroke-width="2"/>
  <polygon points="140,170 153,163 153,177" fill="#555"/>
  <text x="195" y="160" font-family="SF Mono, monospace" font-size="9" fill="#666">No</text>

  <rect x="20" y="150" width="120" height="40" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="80" y="167" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">Allow exit</text>
  <text x="80" y="181" font-family="SF Mono, monospace" font-size="8" fill="#666" text-anchor="middle">(normal, code 0)</text>

  <!-- Yes branch down -->
  <line x1="350" y1="215" x2="350" y2="240" stroke="#555" stroke-width="2"/>
  <polygon points="350,250 343,237 357,237" fill="#555"/>
  <text x="365" y="235" font-family="SF Mono, monospace" font-size="9" fill="#666">Yes</text>

  <!-- Diamond 2: Promise in output? -->
  <polygon points="350,255 460,300 350,345 240,300" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="350" y="297" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">&lt;promise&gt; in</text>
  <text x="350" y="311" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">output?</text>

  <!-- Yes branch right -->
  <line x1="460" y1="300" x2="530" y2="300" stroke="#555" stroke-width="2"/>
  <polygon points="540,300 527,293 527,307" fill="#555"/>
  <text x="495" y="290" font-family="SF Mono, monospace" font-size="9" fill="#666">Yes</text>

  <rect x="540" y="280" width="140" height="40" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="610" y="297" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">Allow exit</text>
  <text x="610" y="311" font-family="SF Mono, monospace" font-size="8" fill="#666" text-anchor="middle">(done, code 0)</text>

  <!-- No branch down -->
  <line x1="350" y1="345" x2="350" y2="365" stroke="#555" stroke-width="2"/>
  <polygon points="350,375 343,362 357,362" fill="#555"/>
  <text x="365" y="362" font-family="SF Mono, monospace" font-size="9" fill="#666">No</text>

  <!-- Diamond 3: iteration >= max? -->
  <polygon points="350,380 450,415 350,450 250,415" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="350" y="412" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">iter &gt;= max?</text>

  <!-- Yes branch right -->
  <line x1="450" y1="415" x2="530" y2="415" stroke="#555" stroke-width="2"/>
  <polygon points="540,415 527,408 527,422" fill="#555"/>
  <text x="490" y="405" font-family="SF Mono, monospace" font-size="9" fill="#666">Yes</text>

  <rect x="540" y="395" width="140" height="40" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="610" y="412" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">Allow exit</text>
  <text x="610" y="426" font-family="SF Mono, monospace" font-size="8" fill="#666" text-anchor="middle">(warn, code 0)</text>

  <!-- No branch down -->
  <line x1="350" y1="450" x2="350" y2="470" stroke="#555" stroke-width="2"/>
  <polygon points="350,480 343,467 357,467" fill="#555"/>
  <text x="365" y="467" font-family="SF Mono, monospace" font-size="9" fill="#666">No</text>

  <!-- Block exit box -->
  <rect x="250" y="480" width="200" height="35" fill="#111" stroke="#fff" stroke-width="2"/>
  <text x="350" y="497" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">Block exit (code 2)</text>
  <text x="350" y="510" font-family="SF Mono, monospace" font-size="8" fill="#666" text-anchor="middle">increment counter, re-feed prompt</text>

  <!-- Dashed loop-back -->
  <path d="M 250,497 L 30,497 L 30,65 L 305,65" fill="none" stroke="#555" stroke-width="1" stroke-dasharray="6,4"/>
  <polygon points="310,65 297,58 297,72" fill="#555"/>

  <!-- Quick Reference Box -->
  <rect x="540" y="120" width="140" height="110" fill="#0a0a0a" stroke="#333" stroke-width="1"/>
  <text x="610" y="140" font-family="SF Mono, monospace" font-size="9" fill="#888" text-anchor="middle">Exit Codes</text>
  <line x1="555" y1="148" x2="665" y2="148" stroke="#333" stroke-width="1"/>
  <text x="555" y="168" font-family="SF Mono, monospace" font-size="8" fill="#555">0  allow exit</text>
  <text x="555" y="185" font-family="SF Mono, monospace" font-size="8" fill="#555">2  block exit</text>
  <line x1="555" y1="195" x2="665" y2="195" stroke="#333" stroke-width="1"/>
  <text x="555" y="215" font-family="SF Mono, monospace" font-size="7" fill="#444">stdin = transcript</text>
</svg>