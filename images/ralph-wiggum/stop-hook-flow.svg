<svg viewBox="0 0 700 550" xmlns="http://www.w3.org/2000/svg" style="background:#000;">
  <!-- Title -->
  <text x="350" y="25" font-family="SF Mono, monospace" font-size="14" fill="#fff" text-anchor="middle" font-weight="bold">Stop Hook Loop Lifecycle</text>

  <!-- Step 1: User invokes /ralph-loop -->
  <rect x="225" y="45" width="250" height="40" fill="#111" stroke="#fff" stroke-width="2"/>
  <text x="350" y="70" font-family="SF Mono, monospace" font-size="10" fill="#fff" text-anchor="middle">User invokes /ralph-loop</text>

  <!-- Arrow down -->
  <line x1="350" y1="85" x2="350" y2="110" stroke="#555" stroke-width="2"/>
  <polygon points="350,120 343,107 357,107" fill="#555"/>

  <!-- Step 2: Setup creates state file -->
  <rect x="225" y="120" width="250" height="40" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="350" y="145" font-family="SF Mono, monospace" font-size="10" fill="#fff" text-anchor="middle">Setup creates state file</text>

  <!-- Arrow down -->
  <line x1="350" y1="160" x2="350" y2="185" stroke="#555" stroke-width="2"/>
  <polygon points="350,195 343,182 357,182" fill="#555"/>

  <!-- Step 3: Claude works on task -->
  <rect x="200" y="195" width="300" height="50" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="350" y="217" font-family="SF Mono, monospace" font-size="11" fill="#fff" text-anchor="middle">Claude works on task</text>
  <text x="350" y="234" font-family="SF Mono, monospace" font-size="8" fill="#666" text-anchor="middle">reads state file, executes prompt</text>

  <!-- Arrow down -->
  <line x1="350" y1="245" x2="350" y2="270" stroke="#555" stroke-width="2"/>
  <polygon points="350,280 343,267 357,267" fill="#555"/>

  <!-- Step 4: Claude tries to exit -->
  <rect x="225" y="280" width="250" height="40" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="350" y="305" font-family="SF Mono, monospace" font-size="10" fill="#fff" text-anchor="middle">Claude tries to exit</text>

  <!-- Arrow down -->
  <line x1="350" y1="320" x2="350" y2="345" stroke="#555" stroke-width="2"/>
  <polygon points="350,355 343,342 357,342" fill="#555"/>

  <!-- Diamond: Promise found? -->
  <polygon points="350,360 440,400 350,440 260,400" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="350" y="396" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">&lt;promise&gt;</text>
  <text x="350" y="410" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">found?</text>

  <!-- Yes branch right: Exit allowed -->
  <line x1="440" y1="400" x2="510" y2="400" stroke="#555" stroke-width="2"/>
  <polygon points="520,400 507,393 507,407" fill="#555"/>
  <text x="475" y="390" font-family="SF Mono, monospace" font-size="9" fill="#666">Yes</text>

  <rect x="520" y="380" width="150" height="40" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="595" y="397" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">Exit allowed</text>
  <text x="595" y="411" font-family="SF Mono, monospace" font-size="8" fill="#666" text-anchor="middle">exit code 0</text>

  <!-- No branch down -->
  <line x1="350" y1="440" x2="350" y2="460" stroke="#555" stroke-width="2"/>
  <polygon points="350,470 343,457 357,457" fill="#555"/>
  <text x="365" y="455" font-family="SF Mono, monospace" font-size="9" fill="#666">No</text>

  <!-- Diamond: Max iterations? -->
  <polygon points="350,470 430,500 350,530 270,500" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="350" y="497" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">Max iters</text>
  <text x="350" y="511" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">reached?</text>

  <!-- Yes branch right: Exit with warning -->
  <line x1="430" y1="500" x2="510" y2="500" stroke="#555" stroke-width="2"/>
  <polygon points="520,500 507,493 507,507" fill="#555"/>
  <text x="470" y="490" font-family="SF Mono, monospace" font-size="9" fill="#666">Yes</text>

  <rect x="520" y="480" width="150" height="40" fill="#111" stroke="#444" stroke-width="1"/>
  <text x="595" y="497" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">Exit allowed</text>
  <text x="595" y="511" font-family="SF Mono, monospace" font-size="8" fill="#666" text-anchor="middle">(warn: max reached)</text>

  <!-- No branch left: Block exit -->
  <line x1="270" y1="500" x2="200" y2="500" stroke="#555" stroke-width="2"/>
  <polygon points="190,500 203,493 203,507" fill="#555"/>
  <text x="235" y="490" font-family="SF Mono, monospace" font-size="9" fill="#666">No</text>

  <rect x="55" y="480" width="135" height="40" fill="#111" stroke="#fff" stroke-width="2"/>
  <text x="122" y="497" font-family="SF Mono, monospace" font-size="9" fill="#fff" text-anchor="middle">Block exit</text>
  <text x="122" y="511" font-family="SF Mono, monospace" font-size="8" fill="#666" text-anchor="middle">exit code 2</text>

  <!-- Dashed loop-back arrow from Block exit back to "Claude works" -->
  <path d="M 55,500 L 30,500 L 30,220 L 195,220" fill="none" stroke="#555" stroke-width="2" stroke-dasharray="6,4"/>
  <polygon points="200,220 187,213 187,227" fill="#555"/>
  <text x="40" y="365" font-family="SF Mono, monospace" font-size="8" fill="#888" transform="rotate(-90,40,365)">iteration N+1</text>
</svg>